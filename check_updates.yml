---
- name: Verificar actualizaciones de Windows
  hosts: all
  gather_facts: no
  tasks:
    - name: Obtener actualizaciones pendientes
      win_shell: |
        Import-Module PSWindowsUpdate
        Get-WindowsUpdate -MicrosoftUpdate -IgnoreReboot |
        Select-Object KBArticleID, Title, Size, Classification |
        ConvertTo-Json
      register: updates
      become: yes
      become_method: runas

    - name: Mostrar actualizaciones pendientes
      debug:
        var: updates.stdout
